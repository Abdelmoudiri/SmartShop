version: '3.8'

services:
  mysqldb:
    image: mysql:8.0
    container_name: smartshop-mysql-dev
    environment:
      MYSQL_DATABASE: smartshop_db
      MYSQL_ROOT_PASSWORD: root
    ports:
      - "3306:3306"
    volumes:
      - db_data:/var/lib/mysql  # Volume Docker (persistance)

  app:
    image: eclipse-temurin:17-jdk
    container_name: smartshop-backend-dev
    working_dir: /app
    volumes:
      # BIND MOUNTS : Synchronisation temps réel
      - ./src:/app/src                    # Code source
      - ./pom.xml:/app/pom.xml            # Dépendances Maven
      - ./mvnw:/app/mvnw                  # Maven wrapper
      - ./.mvn:/app/.mvn                  # Config Maven
      - ~/.m2:/root/.m2                   # Cache Maven (évite de retélécharger)
      - maven-target:/app/target          # Volume pour les fichiers compilés
    ports:
      - "8081:8080"
    environment:
      DB_HOST: mysqldb
      DB_PORT: 3306
      DB_NAME: smartshop_db
      DB_USERNAME: root
      DB_PASSWORD: root
      SPRING_DEVTOOLS_RESTART_ENABLED: "true"
    command: ./mvnw spring-boot:run
    depends_on:
      - mysqldb

volumes:
  db_data:      # Volume Docker pour MySQL
  maven-target: # Volume Docker pour fichiers compilés (performance)
